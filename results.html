<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>2rism ‚Äì –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ –ø–∞–Ω–µ–ª–µ–π */
        .scrollable-panel {
            height: calc(100vh - 180px);
            overflow-y: auto;
            padding-right: 10px;
        }

        .scrollable-panel::-webkit-scrollbar {
            width: 8px;
        }

        .scrollable-panel::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .scrollable-panel::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .scrollable-panel::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .back-to-search {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: 1px solid var(--primary-color);
            border-radius: var(--radius-medium);
            transition: all 0.2s;
        }

        .back-to-search:hover {
            background: var(--primary-color);
            color: white;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="container header__inner">
            <h1 class="logo">2rism</h1>
            <nav class="nav">
                <ul class="nav__list">
                    <li><a href="/search">–ü–æ–∏—Å–∫</a></li>
                    <li><a href="/account">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</a></li>
                    <li><a href="#" onclick="logout(); return false;">–í—ã–π—Ç–∏</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container results-page">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è) -->
        <aside class="filters-sidebar">
            <div class="scrollable-panel">
                <div class="results-header">
                    <h3 class="filters-title">–§–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</h3>
                    <a href="/search" class="back-to-search">
                        ‚Üê –ù–æ–≤—ã–π –ø–æ–∏—Å–∫
                    </a>
                </div>

                <!-- –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã -->
                <div id="active-filters" class="active-filters" style="display: none;">
                    <strong>–ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:</strong>
                    <div id="filter-tags"></div>
                    <button id="clear-all-filters" class="clear-filters">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ</button>
                </div>

                <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–ª–∏–Ω–µ -->
                <div class="filter-group">
                    <p class="filter-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–ª–∏–Ω–µ —Ç—É—Ä–∞:</p>
                    <label class="filter-radio">
                        <input type="radio" name="sort_days" value="all" checked> –í—Å–µ —Ç—É—Ä—ã
                    </label>
                    <label class="filter-radio">
                        <input type="radio" name="sort_days" value="days_asc"> –ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
                    </label>
                    <label class="filter-radio">
                        <input type="radio" name="sort_days" value="days_desc"> –ü–æ —É–±—ã–≤–∞–Ω–∏—é
                    </label>
                </div>

                <!-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ -->
                <div class="filter-group">
                    <p class="filter-label">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç–æ–∏–º–æ—Å—Ç–∏:</p>
                    <label class="filter-radio">
                        <input type="radio" name="price_sort" value="price_asc" checked> –ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
                    </label>
                    <label class="filter-radio">
                        <input type="radio" name="price_sort" value="price_desc"> –ü–æ —É–±—ã–≤–∞–Ω–∏—é
                    </label>
                </div>

                <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Ü–µ–Ω–µ -->
                <div class="filter-group">
                    <p class="filter-label">–¶–µ–Ω–∞ (BYN):</p>
                    <div class="price-inputs">
                        <label>–û—Ç: <input type="number" id="minPrice" placeholder="0" min="0" value="0"></label>
                        <label>–î–æ: <input type="number" id="maxPrice" placeholder="10000" min="0" value="10000"></label>
                    </div>
                </div>

                <!-- –§–∏–ª—å—Ç—Ä –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
                <div class="filter-group">
                    <p class="filter-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—É—Ä–∞ (–¥–Ω–µ–π):</p>
                    <div class="price-inputs">
                        <label>–û—Ç: <input type="number" id="minDays" placeholder="1" min="1" value="1"></label>
                        <label>–î–æ: <input type="number" id="maxDays" placeholder="30" min="1" value="30"></label>
                    </div>
                </div>

                <!-- –ì–æ—Ä—è—â–∏–µ —Ç—É—Ä—ã (–ò–°–ü–†–ê–í–õ–ï–ù–û: radio –Ω–∞ checkbox) -->
                <div class="filter-group">
                    <p class="filter-label">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:</p>
                    <label class="filter-checkbox">
                        <input type="checkbox" id="hot-tours-checkbox" name="hot_tours"> –¢–æ–ª—å–∫–æ –≥–æ—Ä—è—â–∏–µ —Ç—É—Ä—ã
                    </label>
                </div>

                <button id="apply-filters" class="btn" style="width: 100%; margin-top: 10px;">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>

                <div class="sidebar-image-placeholder"></div>
            </div>
        </aside>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ -->
        <main class="results-main">
            <div class="scrollable-panel">
                <div class="sort-bar">
                    <span id="results-count">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>

                <div class="results-list" id="tours-list">
                    <!-- –¢—É—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—É—Ä–æ–≤...</div>
                </div>
            </div>
        </main>

        <script>
            // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
            let currentFilters = {
                from: '',
                to: '',
                transport: '',
                sort_days: 'all',
                sort_price: 'price_asc',
                minPrice: '',
                maxPrice: '',
                minDays: '',
                maxDays: '',
                hot_tours: ''
            };

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç—É—Ä–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.addEventListener('DOMContentLoaded', function () {
                console.log('üîÑ –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');

                // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
                const urlParams = new URLSearchParams(window.location.search);
                console.log('üîç –ü–∞—Ä–∞–º–µ—Ç—Ä—ã URL:', Object.fromEntries(urlParams.entries()));

                // –ë–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞
                currentFilters.from = urlParams.get('from') || '';
                currentFilters.to = urlParams.get('to') || '';
                currentFilters.transport = urlParams.get('transport') || '';

                // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                currentFilters.sort_days = urlParams.get('sort_days') || 'all';
                currentFilters.sort_price = urlParams.get('price_sort') || 'price_asc';

                // –§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º
                currentFilters.minPrice = urlParams.get('minPrice') || '';
                currentFilters.maxPrice = urlParams.get('maxPrice') || '';
                currentFilters.minDays = urlParams.get('minDays') || '';
                currentFilters.maxDays = urlParams.get('maxDays') || '';
                currentFilters.hot_tours = urlParams.get('hot_tours') || '';

                console.log('üìã –¢–µ–∫—É—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ URL:', currentFilters);

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ URL
                setFilterValuesFromURL();

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—É—Ä—ã
                loadTours();

                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
                updateActiveFilters();

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
                document.getElementById('apply-filters').addEventListener('click', function () {
                    console.log('üéØ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã"');
                    applyFilters();
                });

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
                document.getElementById('clear-all-filters').addEventListener('click', function () {
                    console.log('üîÑ –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ"');
                    clearAllFilters();
                });

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ò–°–ü–†–ê–í–õ–ï–ù–û –∏–º—è)
                document.querySelectorAll('input[name="sort_days"]').forEach(radio => {
                    radio.addEventListener('change', function () {
                        console.log(`üìÖ –ò–∑–º–µ–Ω–µ–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–ª–∏–Ω–µ: ${this.value}`);
                        currentFilters.sort_days = this.value;
                    });
                });

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —Ü–µ–Ω–µ
                document.querySelectorAll('input[name="price_sort"]').forEach(radio => {
                    radio.addEventListener('change', function () {
                        console.log(`üí∞ –ò–∑–º–µ–Ω–µ–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ: ${this.value}`);
                        currentFilters.sort_price = this.value;
                    });
                });

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —á–µ–∫–±–æ–∫—Å–∞ –≥–æ—Ä—è—â–∏—Ö —Ç—É—Ä–æ–≤ (–ò–°–ü–†–ê–í–õ–ï–ù–û —Å radio –Ω–∞ checkbox)
                const hotToursCheckbox = document.getElementById('hot-tours-checkbox');
                hotToursCheckbox.addEventListener('change', function () {
                    console.log(`üî• –ò–∑–º–µ–Ω–µ–Ω —Ñ–∏–ª—å—Ç—Ä –≥–æ—Ä—è—â–∏—Ö —Ç—É—Ä–æ–≤: ${this.checked ? 'hot_only' : ''}`);
                    currentFilters.hot_tours = this.checked ? 'hot_only' : '';
                });
            });

            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ URL
            function setFilterValuesFromURL() {
                console.log('‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ URL');

                // –†–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–ª–∏–Ω–µ (–ò–°–ü–†–ê–í–õ–ï–ù–û –∏–º—è)
                const daysSortRadio = document.querySelector(`input[name="sort_days"][value="${currentFilters.sort_days}"]`);
                if (daysSortRadio) {
                    daysSortRadio.checked = true;
                    console.log(`  ‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω radio sort_days: ${currentFilters.sort_days}`);
                } else {
                    console.log(`  ‚úó Radio sort_days –Ω–µ –Ω–∞–π–¥–µ–Ω: ${currentFilters.sort_days}`);
                }

                // –†–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ —Ü–µ–Ω–µ
                const priceSortRadio = document.querySelector(`input[name="price_sort"][value="${currentFilters.sort_price}"]`);
                if (priceSortRadio) {
                    priceSortRadio.checked = true;
                    console.log(`  ‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω radio price_sort: ${currentFilters.sort_price}`);
                } else {
                    console.log(`  ‚úó Radio price_sort –Ω–µ –Ω–∞–π–¥–µ–Ω: ${currentFilters.sort_price}`);
                }

                // –ß–µ–∫–±–æ–∫—Å –≥–æ—Ä—è—â–∏—Ö —Ç—É—Ä–æ–≤ (–ò–°–ü–†–ê–í–õ–ï–ù–û —Å radio –Ω–∞ checkbox)
                const hotToursCheckbox = document.getElementById('hot-tours-checkbox');
                if (currentFilters.hot_tours === 'hot_only') {
                    hotToursCheckbox.checked = true;
                    console.log(`  ‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω checkbox hot_tours: –≥–æ—Ä—è—â–∏–µ`);
                } else {
                    hotToursCheckbox.checked = false;
                    console.log(`  ‚úó Checkbox hot_tours: –≤—Å–µ —Ç—É—Ä—ã`);
                }

                // –ü–æ–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
                if (currentFilters.minPrice) {
                    document.getElementById('minPrice').value = currentFilters.minPrice;
                    console.log(`  ‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω minPrice: ${currentFilters.minPrice}`);
                }
                if (currentFilters.maxPrice) {
                    document.getElementById('maxPrice').value = currentFilters.maxPrice;
                    console.log(`  ‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω maxPrice: ${currentFilters.maxPrice}`);
                }
                if (currentFilters.minDays) {
                    document.getElementById('minDays').value = currentFilters.minDays;
                    console.log(`  ‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω minDays: ${currentFilters.minDays}`);
                }
                if (currentFilters.maxDays) {
                    document.getElementById('maxDays').value = currentFilters.maxDays;
                    console.log(`  ‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω maxDays: ${currentFilters.maxDays}`);
                }
            }

            // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–æ–≤
            async function loadTours() {
                console.log('üîÑ –ù–∞—á–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–æ–≤');

                const toursList = document.getElementById('tours-list');
                toursList.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—É—Ä–æ–≤...</div>';

                // –§–æ—Ä–º–∏—Ä—É–µ–º URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
                const params = new URLSearchParams();
                let paramCount = 0;

                for (const [key, value] of Object.entries(currentFilters)) {
                    if (value !== '' && value !== 'all') {
                        params.append(key, value.toString());
                        paramCount++;
                    }
                }

                const url = `/api/tours?${params.toString()}`;
                console.log(`üîó –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º URL: ${url}`);
                console.log(`üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: ${paramCount}`);

                try {
                    console.log('‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ API...');
                    const response = await fetch(url);

                    if (!response.ok) {
                        throw new Error(`HTTP –æ—à–∏–±–∫–∞! –°—Ç–∞—Ç—É—Å: ${response.status}`);
                    }

                    const tours = await response.json();
                    console.log(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ —Ç—É—Ä–æ–≤: ${tours.length}`);

                    displayTours(tours);

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
                    const countText = tours.length === 0 ? '–¢—É—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã' : `–ù–∞–π–¥–µ–Ω–æ —Ç—É—Ä–æ–≤: ${tours.length}`;
                    document.getElementById('results-count').textContent = countText;

                    // –û–±–Ω–æ–≤–ª—è–µ–º URL –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    updateURL();

                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
                    updateActiveFilters();

                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–æ–≤:', error);
                    toursList.innerHTML = `
                <div class="error">
                    <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—É—Ä–æ–≤</h3>
                    <p>${error.message}</p>
                    <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É.</p>
                </div>
            `;
                }
            }

            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç—É—Ä–æ–≤
            function displayTours(tours) {
                const toursList = document.getElementById('tours-list');

                if (tours.length === 0) {
                    console.log('üì≠ –¢—É—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                    toursList.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #666;">
                <h3>–¢—É—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä—ã</p>
                <button onclick="clearAllFilters()" class="btn" style="margin-top: 20px;">
                    –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
                </button>
            </div>
        `;
                    return;
                }

                console.log(`üé® –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${tours.length} —Ç—É—Ä–æ–≤`);
                toursList.innerHTML = '';

                tours.forEach((tour, index) => {
                    const tourCard = document.createElement('div');
                    tourCard.className = 'result-card';

                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã
                    const startDate = tour.start_date ? new Date(tour.start_date).toLocaleDateString('ru-RU') : '–£—Ç–æ—á–Ω—è–µ—Ç—Å—è';
                    const endDate = tour.end_date ? new Date(tour.end_date).toLocaleDateString('ru-RU') : '–£—Ç–æ—á–Ω—è–µ—Ç—Å—è';

                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–µ–π–¥–∂ –¥–ª—è –≥–æ—Ä—è—â–∏—Ö —Ç—É—Ä–æ–≤
                    const hotBadge = tour.is_hot ? '<span class="hot-badge">üî• –ì–û–†–Ø–©–ò–ô</span>' : '';

                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Ç—É—Ä–∞
                    const isAvailable = tour.is_available !== false; // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

                    tourCard.innerHTML = `
            <div class="card-info">
                <h3>${tour.title} ${hotBadge}</h3>
                <div class="card-details">
                    <p><strong>–ú–∞—Ä—à—Ä—É—Ç:</strong> ${tour.from_city} ‚Üí ${tour.to_city}</p>
                    <p><strong>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç:</strong> ${tour.transport}</p>
                    <p><strong>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:</strong> ${tour.days} ${getDaysText(tour.days)}</p>
                    <p><strong>–î–∞—Ç—ã:</strong> ${startDate} - ${endDate}</p>
                    ${tour.description ? `<p>${tour.description.substring(0, 100)}...</p>` : ''}
                </div>
            </div>
            <div class="card-price-action">
                <div class="price-block">
                    <span class="card-price">${parseFloat(tour.price).toFixed(2)} BYN</span>
                    <span class="price-per-day">${(parseFloat(tour.price) / tour.days).toFixed(2)} BYN/–¥–µ–Ω—å</span>
                </div>
                ${isAvailable ?
                            `<button class="card-button" onclick="reserveTour(${tour.id})" 
                             data-tour="${tour.id}">
                        –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                     </button>` :
                            `<button class="card-button reserved" disabled>
                        üîí –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ
                     </button>`
                        }
            </div>
        `;

                    toursList.appendChild(tourCard);
                });
            }

            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–∫–ª–æ–Ω–µ–Ω–∏—è "–¥–Ω–µ–π"
            function getDaysText(days) {
                if (days % 10 === 1 && days % 100 !== 11) return '–¥–µ–Ω—å';
                if (days % 10 >= 2 && days % 10 <= 4 && (days % 100 < 10 || days % 100 >= 20)) return '–¥–Ω—è';
                return '–¥–Ω–µ–π';
            }



            // –§—É–Ω–∫—Ü–∏—è —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—É—Ä–∞
            async function reserveTour(tourId) {
                try {
                    // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const userResponse = await fetch('/api/user/current');
                    if (!userResponse.ok) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—É—Ä–æ–≤');
                        window.location.href = '/login';
                        return;
                    }

                    const user = await userResponse.json();
                    const userId = user.id;

                    if (!confirm(`–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ç—É—Ä –Ω–∞ 15 –º–∏–Ω—É—Ç?\n–ü–æ—Å–ª–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—É—Ä —Å—Ç–∞–Ω–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.`)) {
                        return;
                    }

                    console.log(`–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—É—Ä–∞ ${tourId} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ${userId}`);

                    const response = await fetch('/api/reserve', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ tourId, userId })
                    });

                    const result = await response.json();

                    if (result.success) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É
                        const button = document.querySelector(`button[data-tour="${tourId}"]`);
                        if (button) {
                            button.className = 'card-button reserved';
                            button.disabled = true;
                            button.innerHTML = `–ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ (<span class="timer" data-expires="${result.expiresAt}">15:00</span>)`;

                            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
                            if (typeof startTimer === 'function') {
                                const timerElement = button.querySelector('.timer');
                                startTimer(timerElement, new Date(result.expiresAt));
                            }
                        }

                        alert('–¢—É—Ä —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞ 15 –º–∏–Ω—É—Ç!\n–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.');
                    } else {
                        alert(result.error || '–û—à–∏–±–∫–∞ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                    alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–∏');
                }
            }


            `
${tour.is_available ?
                    `<button class="card-button" onclick="reserveTour(${tour.id})" 
             data-tour="${tour.id}">
        –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
     </button>` :
                    `<button class="card-button reserved" disabled>
        üîí –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ
     </button>`
                }
`

            // –î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞:
            const CURRENT_USER_ID = 1; // –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞

            // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
            function applyFilters() {
                console.log('‚öôÔ∏è –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤...');

                // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ –ø–æ–ª–µ–π
                const minPrice = document.getElementById('minPrice').value.trim();
                const maxPrice = document.getElementById('maxPrice').value.trim();
                const minDays = document.getElementById('minDays').value.trim();
                const maxDays = document.getElementById('maxDays').value.trim();

                console.log(`üìù –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π: minPrice=${minPrice}, maxPrice=${maxPrice}, minDays=${minDays}, maxDays=${maxDays}`);

                // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–∏
                const daysSortRadio = document.querySelector('input[name="sort_days"]:checked');
                const priceSortRadio = document.querySelector('input[name="price_sort"]:checked');
                const hotToursCheckbox = document.getElementById('hot-tours-checkbox');

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
                currentFilters.minPrice = minPrice;
                currentFilters.maxPrice = maxPrice;
                currentFilters.minDays = minDays;
                currentFilters.maxDays = maxDays;
                currentFilters.sort_days = daysSortRadio ? daysSortRadio.value : 'all';
                currentFilters.sort_price = priceSortRadio ? priceSortRadio.value : 'price_asc';
                currentFilters.hot_tours = hotToursCheckbox.checked ? 'hot_only' : '';

                console.log('üìã –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:', currentFilters);

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—É—Ä—ã —Å –Ω–æ–≤—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
                loadTours();
            }

            // –§—É–Ω–∫—Ü–∏—è —Å–±—Ä–æ—Å–∞ –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
            function clearAllFilters() {
                console.log('üîÑ –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤');

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ results, —Å–æ—Ö—Ä–∞–Ω—è—è –±–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞
                const baseFilters = {
                    from: currentFilters.from,
                    to: currentFilters.to,
                    transport: currentFilters.transport,
                    sort_days: 'all',
                    sort_price: 'price_asc',
                    minPrice: '',
                    maxPrice: '',
                    minDays: '',
                    maxDays: '',
                    hot_tours: ''
                };

                currentFilters = baseFilters;

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É
                document.querySelector('input[name="sort_days"][value="all"]').checked = true;
                document.querySelector('input[name="price_sort"][value="price_asc"]').checked = true;
                document.getElementById('hot-tours-checkbox').checked = false;
                document.getElementById('minPrice').value = '';
                document.getElementById('maxPrice').value = '';
                document.getElementById('minDays').value = '';
                document.getElementById('maxDays').value = '';

                console.log('üìã –§–∏–ª—å—Ç—Ä—ã –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞:', currentFilters);

                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç—É—Ä—ã
                loadTours();
            }

            // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è URL
            function updateURL() {
                const params = new URLSearchParams();

                for (const [key, value] of Object.entries(currentFilters)) {
                    if (value !== '' && value !== 'all') {
                        params.append(key, value.toString());
                    }
                }

                const newUrl = `/results?${params.toString()}`;
                console.log(`üîó –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL: ${newUrl}`);
                window.history.replaceState({}, '', newUrl);
            }

            // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
            function updateActiveFilters() {
                const activeFiltersDiv = document.getElementById('active-filters');
                const filterTagsDiv = document.getElementById('filter-tags');
                filterTagsDiv.innerHTML = '';

                let hasActiveFilters = false;

                // –ë–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞
                if (currentFilters.from) {
                    filterTagsDiv.innerHTML += `<span class="active-filter-tag">–ò–∑: ${currentFilters.from}</span>`;
                    hasActiveFilters = true;
                }

                if (currentFilters.to) {
                    filterTagsDiv.innerHTML += `<span class="active-filter-tag">–í: ${currentFilters.to}</span>`;
                    hasActiveFilters = true;
                }

                if (currentFilters.transport) {
                    filterTagsDiv.innerHTML += `<span class="active-filter-tag">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: ${currentFilters.transport}</span>`;
                    hasActiveFilters = true;
                }

                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ò–°–ü–†–ê–í–õ–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º sort_days –≤–º–µ—Å—Ç–æ days_sort)
                if (currentFilters.sort_days === 'days_asc') {
                    filterTagsDiv.innerHTML += `<span class="active-filter-tag">–°–æ—Ä—Ç.: –¥–ª–∏–Ω–∞ ‚Üë</span>`;
                    hasActiveFilters = true;
                } else if (currentFilters.sort_days === 'days_desc') {
                    filterTagsDiv.innerHTML += `<span class="active-filter-tag">–°–æ—Ä—Ç.: –¥–ª–∏–Ω–∞ ‚Üì</span>`;
                    hasActiveFilters = true;
                }

                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ
                if (currentFilters.sort_price === 'price_desc') {
                    filterTagsDiv.innerHTML += `<span class="active-filter-tag">–°–æ—Ä—Ç.: —Ü–µ–Ω–∞ ‚Üì</span>`;
                    hasActiveFilters = true;
                }

                // –§–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º
                if (currentFilters.minPrice) {
                    filterTagsDiv.innerHTML += `<span class="active-filter-tag">–û—Ç ${currentFilters.minPrice} BYN</span>`;
                    hasActiveFilters = true;
                }

                if (currentFilters.maxPrice) {
                    filterTagsDiv.innerHTML += `<span class="active-filter-tag">–î–æ ${currentFilters.maxPrice} BYN</span>`;
                    hasActiveFilters = true;
                }

                if (currentFilters.minDays) {
                    filterTagsDiv.innerHTML += `<span class="active-filter-tag">–û—Ç ${currentFilters.minDays} –¥–Ω–µ–π</span>`;
                    hasActiveFilters = true;
                }

                if (currentFilters.maxDays) {
                    filterTagsDiv.innerHTML += `<span class="active-filter-tag">–î–æ ${currentFilters.maxDays} –¥–Ω–µ–π</span>`;
                    hasActiveFilters = true;
                }

                // –ì–æ—Ä—è—â–∏–µ —Ç—É—Ä—ã (–ò–°–ü–†–ê–í–õ–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º hot_tours –≤–º–µ—Å—Ç–æ hot_tours —Ä–∞–¥–∏–æ-–∑–Ω–∞—á–µ–Ω–∏—è)
                if (currentFilters.hot_tours === 'hot_only') {
                    filterTagsDiv.innerHTML += `<span class="active-filter-tag">–¢–æ–ª—å–∫–æ –≥–æ—Ä—è—â–∏–µ</span>`;
                    hasActiveFilters = true;
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
                if (hasActiveFilters) {
                    activeFiltersDiv.style.display = 'block';
                    console.log('üè∑Ô∏è –ê–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
                } else {
                    activeFiltersDiv.style.display = 'none';
                    console.log('üè∑Ô∏è –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤');
                }
            }
        </script>
    </div>

    <script>
        function logout() {
            if (confirm('–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã?')) {
                window.location.href = '/logout';
            }
        }
    </script>

    <script src="/timer.js"></script>

</body>

</html>